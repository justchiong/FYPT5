<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kodo</title>
    <link rel="shortcut icon" type="image/jpg" href="/kodoLogo.png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js">
    </script>

    <style>
        body {
            /* background-color: #372152; */
            background-color: #494654;
        }

        .kodo-purple {
            background-color: #4304c2 !important;
        }

        .kodo-yellow {
            background-color: #e5ba3f;
        }

        .kodo-gray {
            background-color: #45414f;
        }

        .kodo-lightgray {
            background-color: #908c9c;
        }

        .navlinkcolor {
            color: black !important;
        }

        .jumboStyle {
            /*background-color: #241b29 !important;*/
            background-color: #4304c2;
            color: white !important;
        }

        .navStyle {
            background-color: white;
        }

        .blacktext {
            color: black !important;
        }

        .yellowtext {
            color: #e5ba3f !important;
        }

        .navbar-fonts {
            color: black !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: larger;
        }

        .mt-10 {
            margin-top: 15%;
        }

        .ml-10 {
            margin-left: 10%;
        }

        .afterNav {
            margin-top: 100px;
        }

        .container-fluid {
            max-width: 85%;
        }

        td {
            padding-top: 0px !important;
            padding-bottom: 0px !important;
        }

        .card-header {
            padding-top: 10px !important;
            padding-bottom: 5px !important;
        }

        .column1 {
            width: 35%;
        }

        .column2 {
            width: 45%;
        }

        .column3 {
            width: 20%;
            text-align: center;
        }

        .cardhover:hover {
            background-color: #524d5e;
        }

        .cardhover {
            background-color: #45414f;
            color: #E2E2E2;
        }

        @media only screen and (max-width: 600px) {
            #accordion {
                padding-left: 0%;
                padding-right: 0%;
            }
        }

        @media only screen and (min-width: 600px) {
            #accordion {
                padding-left: 5%;
                padding-right: 5%;
            }
        }

        @media only screen and (min-width: 1025px) {
            #accordion {
                padding-left: 13%;
                padding-right: 13%;
            }
        }

        .card-body p span {
            font-weight: bold;
        }

        .tableheader {
            color: #45414f;
        }

        .btn:focus {
            box-shadow: none;
        }
        pre code {
            border-radius: 10px;
            max-height: 45vh !important;
        }
        .hljs-ln-numbers {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;

            text-align: center;
            color: #504c5c;
            /*border-right: 1px solid #322f38;*/
            vertical-align: top;
            padding-right: 5px !important;
        }
        .hljs-ln-code {
            padding-left: 10px !important;
        }
    </style>
</head>

<body class="mb-5">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous">
    </script>
    <div class="container-fluid px-0">
        <nav class="navbar navbar-expand-sm bg-light navbar-light justify-content-end fixed-top">
            <!--bg-light navbar-light-->
            <!-- Links -->
            <ul class="navbar-nav pl-5 navbar-fonts" id="appendNavItem">
                <li class="nav-item mx-1 ">
                    <a class="nav-link navlinkcolor" href="./summary.html">Results</a>
                </li>
                <li class="nav-item mx-1 ">
                    <a class="nav-link navlinkcolor" href="./dashboard.html">Scanner</a>
                </li>
                <li class="nav-item mx-1 ">
                    <a class="nav-link navlinkcolor" href="#">Contact Us</a>
                </li>
            </ul>
            <a class="navbar-brand" href="#">
                <img src="./Logo/kodoLogo.png" width="45" height="45" class="d-inline-block align-top mx-2" alt="">
            </a>
        </nav>
    </div>
    <div class="jumbotron jumboStyle">
        <div class="container ml-10 pl-5">
            <h1 class="display-3 mt-5" style="font-weight: bold;">
                Results <img src="/kodoLogo.png" width="100" height="100" class="d-inline-block align-top mx-2" alt="">
            </h1>
            <p class="lead">Enter your unique result access-key here:</p>
            <div class="input-group mb-3 w-50">
                <input type="text" class="form-control" placeholder="access-key from email"
                    aria-label="access-key from email" aria-describedby="button-addon2" id="accesskey">
                <form class="input-group-append" id="getResults">
                    <button class="btn btn-success" type="submit" id="button-addon2">Retrieve</button>
                </form>
            </div>
        </div>
    </div>
    <div id="accordion" class="container-fluid mt-4">
        <div class="card kodo-yellow" id="addResultAfter">
            <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                    <button class="btn w-100" style="height: 2.5em;">
                        <table class="table table-borderless text-left">
                            <tr style="font-weight: bold;">
                                <td class="column1 tableheader">Vulnerability</td>
                                <td class="column2 tableheader">Description</td>
                                <td class="column3 tableheader">Severity</td>
                            </tr>
                        </table>
                    </button>
                </h5>
            </div>
        </div>
    </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
</script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/sunburst.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js">
</script>
<script>
    baseUrl = "http://localhost:3000"
    hljs.initLineNumbersOnLoad();

    //post request to give app.js the accesskey and retrieve params
    $("#getResults").submit((event) => {
        event.preventDefault()
        $('#addResultAfter').nextAll().remove()
        const requestBody = {
            accesskey: $("#accesskey").val()
        }
        axios.post(`${baseUrl}/request/results`, requestBody)
            .then((response) => {
                var allResults = response.data
                allResults = allResults.results
                count = 0
                for (var result in allResults) {
                    result = allResults[result]
                    count = count + 1
                    var resultRowHTML = `
            <!--Start of row ${count} result-->
            <div class="card cardhover">
                <div class="card-header" id="heading${count}">
                    <h5 class="mb-0">
                        <button class="btn collapsed w-100" data-toggle="collapse" data-target="#collapse${count}"
                            aria-expanded="false" aria-controls="collapse${count}">
                            <table class="table table-borderless text-left yellowtext">
                                <thead>
                                    <tr style="font-weight: bold;">
                                        <td class="column1">${result.vulnerability}</td>
                                        <td class="column2">${result.description}</td>
                                        <td class="column3"><span class="badge badge-pill badge-${result.severityColor}">${result.severity}</span></td>
                                    </tr>
                                </thead>
                            </table>
                        </button>
                    </h5>
                </div>
                <div id="collapse${count}" class="collapse" aria-labelledby="heading${count}" data-parent="#accordion">
                    <div class="card-body px-5 kodo-gray">
                        <p><span>Description:&nbsp;&nbsp;</span>${result.description}</p>
                        <p><span>Severity:&nbsp;&nbsp;</span><span class="badge badge-pill badge-${result.severityColor}">${result.severity}</span></p>
                        <p><span>OWASP:&nbsp;&nbsp;</span>${result.owasp}</p>
                        <p><span>CWE:&nbsp;&nbsp;</span>${result.cwe}</p>
                        <br>
                        <p><span>File Path:&nbsp;&nbsp;</span>${result.filepath}</p>
                        <p><span>Line [line:char]:&nbsp;&nbsp;</span>${result.line}</p>
                        <!--EMBEDDED CODE starts here note: code needs to be added to the leftmost(as shown below) without tabbing for it to display on webpage properly-->
                        <pre><code data-ln-start-from="${result.lineStart}">
${result.codeCopied}
                        </code></pre>
                    </div>
                </div>
            </div>
        <!--End of row ${count} result-->`
                    document.getElementById("addResultAfter").insertAdjacentHTML("afterend", resultRowHTML)
                    hljs.highlightAll();
                    hljs.initLineNumbersOnLoad();
                }
            })
            .catch((err) => {
                console.log(err)
            })
    })
</script>

</html>